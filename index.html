<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>eMission System</title>
        <link rel="shortcut icon" type="image/png" href="images/emission_64x64.png"/>
        <link rel="stylesheet" href="style/base.css">
        <link rel="manifest" href="manifest.json" />
    </head>
    <body>
        <header class="work_screen">
            <div id="headerbox">
                <div id="headerboxlink"><img src="images/emission11-web-white.jpg"></div>
                <div id="buttonheader">
                    <!-- top: MainMenu -->
                    <div class="MainMenu topButtons pageOverlay">
                        <div id="headerboxlink"><img class="missionLogo" src="images/DCTOHC11.jpg"></div>
                    </div>
                    <!-- top: Settings SuperUser Download DatabaseInfo SendUser -->
                    <div class= "Settings SuperUser Download DatabaseInfo SendUser topButtons pageOverlay">
                        <div id="headerboxlink"><img class="missionLogo" src="images/DCTOHC11.jpg"></div>
                        <button type="button" class="divbutton return" onclick="objectPage.show( 'back' )">Return</button>
                    </div>
                    <!-- top: Administration PatientPhoto -->
                    <div class= "Administration PatientPhoto topButtons pageOverlay">
                        <div id="headerboxlink"><img class="missionLogo" src="images/DCTOHC11.jpg"></div>
                        <button type="button" class="divbutton return" onclick="objectPage.show( 'MainPage' )" title="Show main menu">Return</button>
                    </div>
                    <!-- top: QuickPhoto -->
                    <div class= "QuickPhoto topButtons pageOverlay">
                        <div id="headerboxlink"><img class="missionLogo" src="images/DCTOHC11.jpg"></div>
                        <button type="button" class="divbutton return" onclick="objectPage.show('back')">Return</button>
                    </div>
                    <!-- top: RemoteDatabaseInput -->
                    <div class="RemoteDatabaseInput topButtons pageOverlay">
                        <button type="button" class="divbutton edit_data">Edit</button>
                        <button type="button" class="divbutton return" onclick="objectPage.show( 'back' )">Cancel</button>
                    </div>
                    <!-- top: AllPatients -->
                    <div class="AllPatients topButtons pageOverlay">
                        <button type="button" class="divbutton return" onclick="objectPage.show( 'MainMenu' )">Return</button>
                        <button type="button" class="divbutton" onclick="objectPage.show( 'PatientNew' )" title="Create a new patient entry">Add Patient</button>
                        <button type="button" class="divbutton" onclick="objectPage.show( 'PatientPhoto' )" id="editreviewpatient" title="menu for this patient">Review/Edit Patient</button>
                    </div>
                    <!-- top: SearchList -->
                    <div class="SearchList topButtons pageOverlay">
                        <button type="button" class="divbutton" onclick="objectPage.show( 'back' )">Return</button>
                        <button type="button" class="divbutton" onclick="objectPage.show( 'MainMenu' )">Main Menu</button>
                        <button type="button" class="divbutton" onclick="objectTable.editpage()" id="editreviewsearch" title="Jump to this search result">Open this record</button>
                    </div>
                    <!-- top: UserList -->
                    <div class="UserList topButtons pageOverlay">
                        <button type="button" class="divbutton" onclick="objectPage.show( 'back' )">Return</button>
                        <button type="button" class="divbutton" onclick="objectPage.show( 'UserNew' )" title="Add a new database user">Add User</button>
                        <button type="button" class="divbutton" onclick="objectPage.show( 'UserEdit' )" id="editreviewuser" title="Edit user's data/password">Review/Edit User</button>
                    </div>
                    <!-- top: AllOperations -->
                    <div class="AllOperations topButtons pageOverlay">
                        <button type="button" class="divbutton" onclick="objectPage.show( 'OperationEdit' )" id="editreviewoperation" title="Update/change info on this operation">Review/Edit Operation</button>
                        <button type="button" class="divbutton return" onclick="objectPage.show( 'back' )">Return</button>
                    </div>
                    <!-- top: OperationList -->
                    <div class="OperationList topButtons pageOverlay">
                        <button type="button" class="divbutton" onclick="objectPage.show( 'OperationNew' )" title="New operation creation for this patient">Add Operation</button>
                        <button type="button" class="divbutton" onclick="objectPage.show( 'OperationEdit' )" id="editreviewoperation" title="Update/change info on this operation">Review/Edit Operation</button>
                        <button type="button" class="divbutton return" onclick="objectPage.show( 'back' )">Return</button>
                    </div>
                    <!-- top: PatientNew -->
                    <div class="PatientData PatientNew topButtons pageOverlay">
                        <button type="button" class="divbutton edit_data">Edit</button>
                        <button type="button" class="divbutton discarddata return" onclick="objectPage.show( 'back' )" title="Abandon this task">Cancel</button>
                    </div>
                    <!-- top: SuperUser -->
                    <div class="PatientData SuperUser topButtons pageOverlay">
                        <button type="button" class="divbutton edit_data">Edit</button>
                        <button type="button" class="divbutton discarddata return" onclick="objectPage.show( 'back' )" title="Discard changes">Cancel</button>
                    </div>
                    <!-- top: UserNew -->
                    <div class="PatientData UserNew topButtons pageOverlay">
                        <button type="button" class="divbutton edit_data">Edit</button>
                        <button type="button" class="divbutton return" onclick="objectPage.show( 'back' )">Cancel</button>
                    </div>
                    <!-- top: UserEdit -->
                    <div class="PatientData UserEdit topButtons pageOverlay">
                        <button type="button" class="divbutton edit_data">Edit</button>
                        <button type="button" class="divbutton delete" onclick="User.del()">Delete User</button>
                        <button type="button" class="divbutton return" onclick="objectPage.show( 'back' )">Cancel</button>
                    </div>
                    <!-- top: MissionInfo -->
                    <div class="PatientData MissionInfo topButtons pageOverlay">
                        <button type="button" class="divbutton" onclick="objectPage.show( 'MissionList')">Mission Notes</button>
                        <button type="button" class="divbutton edit_data">Edit</button>
                        <button type="button" class="divbutton return" onclick="objectPage.show( 'back' )">Cancel</button>
                    </div>
                    <!-- top: PatientDemographics PatientMedical -->
                    <div class="PatientData PatientDemographics PatientMedical topButtons pageOverlay">
                        <button type="button" class="divbutton edit_data">Edit</button>
                        <button type="button" class="divbutton return" onclick="objectPage.show( 'back' )">Cancel</button>
                    </div>
                    <!-- top: OperationEdit -->
                    <div class="PatientData OperationEdit topButtons pageOverlay">
                        <button type="button" class="divbutton edit_data">Edit</button>
                        <button type="button" class="divbutton delete" onclick="Operation.del()">Delete Operation</button>
                        <button type="button" class="divbutton return" onclick="objectPage.show( 'back' )">Return</button>
                    </div>
                    <!-- top: InvalidPatient -->
                    <div class="InvalidPatient topButtons pageOverlay">
                        <button type="button" class="divbutton return" onclick="objectPage.show( 'AllPatients' )">Return</button>
                    </div>
                    <!-- top: NoteList -->
                    <div class="NoteList topButtons pageOverlay">
                        <button class="create_note libutton divbutton" type="button" onclick="objectPage.show( 'NoteNew' )">New Note</button>
                        <button class="createtheimage libutton divbutton Qphoto" type="button">&#128247;</button>
                        <button class="sortOrder libutton divbutton" type="button" onclick="NoteList.by()">by Date</button>
                        <button class="returnfromnote libutton divbutton return" type="button" onclick="objectPage.show( 'back' )">Return</button>
                    </div>
                    <!-- top: MissionList -->
                    <div class="MissionList topButtons pageOverlay">
                        <button type="button" class="divbutton" onclick="objectPage.show( 'MissionInfo')">Mission Info</button>
                        <button class="create_note libutton divbutton" type="button" onclick="objectPage.show( 'NoteNew' )">New Note</button>
                        <button class="createtheimage libutton divbutton Qphoto" type="button">&#128247;</button>
                        <button class="returnfromnote libutton divbutton return" type="button" onclick="objectPage.show( 'back' )">Return</button>
                    </div>
                    <!-- top: EditMode (for any of the PatientData derivatives -->
                    <div class="patientDataEdit pageOverlay">
                        <button type="button" class="divbutton edit_data" disabled>Edit</button>
                        <button type="button" class="divbutton savedata">Save Changes</button>
                        <button type="button" class="divbutton return" onclick="objectPage.show( 'back' )">Cancel</button>
                        <button type="button" class="divbutton Qmark"><B>?</B></button>
                        <button type="button" class="divbutton missionButton"><img src="/style/NoPhoto.png" class="missionButtonImage"></button>
                    </div>
                </div>
            </div>
                <div id="titlebox">
            </div>
        </header>
        <div id="missiondbody" class="work_screen">
            <!-- body: MainMenu -->
            <div class="MainMenu pageOverlay">
                <div id="MainMenuContent" >
                    <button type="button" class="divbutton" onclick="objectPage.show( 'AllPatients' )">All Patients</button>
                    <button type="button" class="divbutton" onclick="objectPage.show( 'AllOperations' )">All Operations</button>
                    <button type="button" class="divbutton" onclick="objectPage.show( 'MissionList' )">The Mission</button>
                    <button type="button" class="divbutton" onclick="objectPage.show( 'Settings' )">Advanced Settings</button>
                    <a href="https://www.github.com/alfille/emission" target="_blank">Instructions</a>
                </div>
            </div>
            <!-- body: Settings -->
            <div class="Settings pageOverlay">
                <div id="SettingsContent">
                    <button type="button" class="divbutton" onclick="objectPage.show( 'MissionInfo' )">Mission Info</button>
                    <button type="button" class="divbutton" onclick="objectPage.show( 'Download' )">Download</button>
                    <button type="button" class="divbutton"  style="visibility:hidden"> </button>
                    <button type="button" class="divbutton" onclick="objectPage.show( 'Administration' )">Privileged operations</button>
                    <button type="button" class="divbutton" onclick="objectPage.show( 'RemoteDatabaseInput' )">Remote Database Setup</button>
                    <button type="button" class="divbutton"  style="visibility:hidden"> </button>
                    <button type="button" class="divbutton delete" onclick="clearLocal()">Clear local data</button>
                </div>
            </div>
            <!-- body: Administration -->
            <div class="Administration pageOverlay">
                <div id="AdministrationContent" >
                    <button type="button" class="divbutton" onclick="objectPage.show( 'SuperUser' )">User Management</button>
                    <button type="button" class="divbutton"  style="visibility:hidden"> </button>
                    <button type="button" class="divbutton" onClick="objectRemote.link()" hint="Open Couchdb Fauxton console">Database Console</button>
                    <button type="button" class="divbutton" onclick="objectPage.show( 'DatabaseInfo' )">Database Information</button>
                    <button type="button" class="divbutton" onclick="objectRemote.forceReplicate()">Force Replicate</button>
                </div>
            </div>
            <!-- body: Download -->
            <div class="Download pageOverlay">
                <div id="DownloadContent" >
                    <h3>Download Spreadsheet file</h3>
                    <button type="button" class="divbutton" onclick="CSV.downloadPatients()">Patient List</button>
                    <button type="button" class="divbutton" onclick="CSV.downloadAll()">All data</button>
                </div>
            </div>
            <!-- body: AllPatients -->
            <div class="AllPatients pageOverlay">
                <div id="PatientListContent" >
                    <table id="AllPatients"></table>
                </div>
            </div>
            <!-- body: SearchList -->
            <div class="SearchList pageOverlay">
                <div id="searchbar"><input type="search" id="searchtext" autofocus="true" value="" onsearch="objectSearch.toTable()"><button type="button" class="search" onclick="objectSearch.toTable()">Search</button></div>
                <div id="SearchListContent" >
                    <table id="SearchList"></table>
                </div>
            </div>
            <!-- body: UserList -->
            <div class="UserList pageOverlay">
                <div id="UserListContent" >
                    <table id="UserList"></table>
                </div>
            </div>
            <!-- body: AllOperations OperationList -->
            <div class="AllOperations OperationList pageOverlay">
                <div id="OperationListContent" >
                    <table id="OperationsList"></table>
                </div>
            </div>
            <!-- body: PatientNew PatientDemographics PatientMedical OperationEdit RemoteDatabaseInput DatabaseInfo SuperUser UserNew UserEdit MissionInfo -->
            <div class="PatientData PatientNew PatientDemographics PatientMedical OperationEdit RemoteDatabaseInput DatabaseInfo SuperUser UserNew UserEdit MissionInfo pageOverlay">
                <div id="PatientDataContent" ></div>
            </div>
            <!-- body: PatientPhoto -->
            <div class="PatientPhoto pageOverlay">
                <div id="PatientPhotoContent" >
                    <div id="PatientPhotoContent2"></div>
                </div>
                <div id="PatientPhotoButtons">
                    <div class="PatientProcButtons">
                        <button type="button" class="divbutton" onclick="objectPage.show( 'PatientDemographics' )">Demographics</button>
                        <button type="button" class="divbutton" onclick="objectPage.show( 'PatientMedical' )">Medical</button>
                        <button type="button" class="divbutton" onclick="objectPage.show( 'OperationList' )">Operations</button>
                    </div>
                    <div class="PatientProcButtons" id="ProcList">
                        <button type="button" class="divbutton" onclick="objectPage.show( 'NoteList' )">Notes</button>
                        <button class="create_note libutton divbutton" type="button" onclick="objectPage.show( 'NoteNew' )">New Note</button>
                        <button class="createtheimage libutton divbutton Qphoto" type="button">&#128247; New Picture</button>
                    </div>
                    <div class="PatientProcButtons">
                        <button type="button" class="divbutton" onclick="Patient.printCard()">Print Card</button>
                        <button type="button" class="divbutton delete" onclick="Patient.del()">Delete Patient</button>
                    </div>
                </div>
            </div>
            <!-- body: SendUser -->
            <div class="SendUser pageOverlay">
                <div id="SendUserContent" >
                    <div><canvas id="SendUserQR" height=180 width=180>QR code</canvas></div>
                    <div><label>User email:<input type=text readonly=true id="SendUserEmail"></label></div>
                    <div><label>User eMission link:<input type=text readonly=true id="SendUserLink"></label></div>
                    <div><a target="_blank" rel=noopener noreferrer href="" id="SendUserMail">Mail link</a></div>
                    <div><button type="button" class="divbutton" id="SendUserPrint">Print for sending</button></div>
                </div>
            </div>
            <!-- body: InvalidPatient -->
            <div class="InvalidPatient pageOverlay">
                <div id="InvalidPatientContent" >
                    <H2>Not a valid patient ID</H2>
                    <p>Possble causes include your data not yet synced, or changes since this patient was selected</p>
                </div>
            </div>
            <!-- body: NoteList MissionList -->
            <div class="NoteList MissionList pageOverlay">
                <div id="NoteListContent"></div>
            </div>
            <!-- body: NoteNew (quick note) -->
            <div class="NoteNew pageOverlay">
                <div id="NoteNewContent"></div>
            </div>
            <!-- body: QuickPhoto (quick photo) -->
            <div class="QuickPhoto pageOverlay">
                <div id="QuickPhotoContent"></div>
            </div>
            <!-- body: FloatPicture -->
            <img class="FloatPicture pageOverlay" onclick="Image.hideBigPicture(this)">
        </div>
        <!-- copyable parts -->
        <div id="templates" class="pageOverlay">
           <div class="notelabel"><button class="edit_note libutton" type="button">Edit</button> <input type="text" class="flatpickr flatpickr-input" readonly><div class="inly"></div></div>
            <!-- Image display -->
            <div class="imagetemplate">
                <img class="entryfield_image">
            </div>
            <!-- Image edit -->
            <div class="imagetemplate_edit">
                <img class="entryfield_image">
                <div class="editToolbar">
                    <button type="button" class="imageRevert" title="Original image"><span><B>Revert</B></span></button>
                    <button type="button" class="imageGet" title="Get image"><span><B>&#128247;</B></span></button>            
                    <button type="button" class="imageRemove" title="Remove image"><span><B>&#128473;&#128247;</B></span></button>
                    <input type="file" accept="image/*" class="imageBar" capture="environment">
                </div>
            </div>
            <!-- Quick Photo -->
            <div class="imagetemplate_quick">
                <img class="entryfield_image">
                <div class="photoToolbar">
                    <button type="button" class="imageGet" title="Get image"><span><B>&#128247;</B></span></button>            
                    <input type="file" accept="image/*" class="imageBar" capture="environment">
                </div>
            </div>
            <!-- Note display -->
            <div class="notetemplate">
                <img class="entryfield_image">
                <div class="titlediv"><label>Title: <div class="entryfield_title choice" contenteditable></div></label>
                <label class="selectdiv">Type<select disabled><option></option><option>Anesthesia</option><option>Surgery</option><option>Nursing</option></select></label></div>
                <div class="entryfield_text"></div>
            </div>
            <!-- Note edit -->
            <div class="notetemplate_edit">
                <img class="entryfield_image">
                <div class="editToolbar">
                    <button type="button" class="imageSave" title="Save this note"><span><B>Save</B></span></button>
                    <button type="button" class="imageCancel" title="Do not save any changes"><span><B>Cancel</B></span></button>
                    <button type="button" class="imageRevert" title="Original image"><span><B>Revert</B></span></button>
                    <button type="button" class="imageGet" title="Get image"><span><B>&#128247;</B></span></button>            
                    <button type="button" class="imageRemove" title="Remove image"><span><B>&#128473;&#128247;</B></span></button>
                    <button type="button" class="imageDelete delete" title="Delete this note"><span><B>Delete</B></span></button>
                    <input type="file" accept="image/*" class="imageBar" capture="environment">
                </div>
                <div class="titlediv"><label>Title: <div class="entryfield_title choice" contenteditable></div></label>
                <label class="selectdiv">Type<select><option></option><option>Anesthesia</option><option>Surgery</option><option>Nursing</option></select></label></div>
                <div class="entryfield_text" contenteditable></div>
            </div>
            <!-- New Note edit -->
            <div class="newnotetemplate_edit">
                <img class="entryfield_image">
                <div class="editToolbar choice">
                    <button type="button" class="imageSave" title="Save this note"><span><B>Save</B></span></button>
                    <button type="button" class="imageCancel" title="Do not save any changes"><span><B>Cancel</B></span></button>
                    <button type="button" class="imageGet" title="Get image"><span><B>&#128247;</B></span></button>            
                    <button type="button" class="imageRemove" title="Remove image"><span><B>&#128473;&#128247;</B></span></button>
                    <input type="file" accept="image/*" class="imageBar" capture="environment">
                </div>
                <div class="titlediv"><label>Title: <div class="entryfield_title choice" contenteditable></div></label>
                <label class="selectdiv">Type<select><option></option><option>Anesthesia</option><option>Surgery</option><option>Nursing</option></select></label></div>
                <div class="entryfield_text choice" contenteditable></div>
            </div>
            <fieldset><legend><button type="button" value="show" onclick="objectPatientData.fsclick(this)">&#10134;</button></legend></fieldset>
            <!-- more top buttons -->
            <div id="moreTop">
                <button type="button" class="divbutton Search">&#x1F50E;&#xFE0E;</button>
                <button type="button" class="divbutton Qmark"><B>?</B></button>
                <button type="button" class="divbutton missionButton"><img src="/style/NoPhoto.png" class="missionButtonImage"></button>
            </div>
        </div>
        <!-- Footer -->
        <footer class="work_screen">
            <div id="footerflex">
                <div><label for="userstatus">User:</label></div>
                <div><input type="text" readonly id="userstatus"></div>
                <div><label for "syncstatus">Sync status:</label></div>
                <div><input type="text" readonly id="syncstatus"></div>
            </div>
        </footer>
        <!-- Card print -->
        <div class="print_patient">
            <div id="printCard">
                <div class=rowCard>
                    <div><img id="photoCard" alt="Patient photo"></div>
                    <div><canvas class="qrCard" height=180 width=180></canvas></div>
                </div>
                <div class=rowCard>
                    <div><table>
                        <tr><td>Name</td><td></td></tr>
                        <tr><td>Complaints</td><td></td></tr>
                        <tr><td>Procedure</td><td></td></tr>
                        <tr><td>Length</td><td></td></tr>
                        <tr><td>Surgeon</td><td></td></tr>
                        <tr><td>ASA</td><td></td></tr>
                    </table></div>
                </div>
                <div class=rowCard>
                    <div><table>
                        <tr><td>Age</td><td></td></tr>
                        <tr><td>Sex</td><td></td></tr>
                        <tr><td>Weight</td><td></td></tr>
                        <tr><td>Allergies</td><td></td></tr>
                        <tr><td>Meds</td><td></td></tr>
                        <tr><td>Equipment</td><td></td></tr>
                    </table></div>
                </div>
            </div>
        </div>
        <!-- User print -->
        <div class="print_user">
            <div id="printUser">
                Simple QR code link:
                
                <center>
                    <div><canvas class="qrUser" height=180 width=180></canvas></div>
                </center>
                <div id="printUserText"></div>
            </div>
        </div>
        <!-- Splash screen -->
        <div id="splash_screen">
            <b><center>
            <h1>eMission System</h1>
            <img src="images/emission_t_square.png" alt="eMission System medical patient database">
            <hr>
                If the application does not appear, contact:.<br>
                <a href="mailto:palfille@partners.org?subject=eMission System error">eMission System team</a>
            <hr>
            </center></b>
        </div>
        
        <!-- scripts -->
        <!-- pouchdb --> <script src="js/pouchdb-7.2.1.min.js"></script>
        <!-- qr --> <script src="js/qrenc-4.0.0.min.js"></script>
        <!-- load search --> <script src="js/elasticlunr.min.js"></script>
        <!-- print routines --> <script src="js/print.min.js"></script>
        <!-- new data-time --> <script src="js/flatpickr.min.js"></script>
        <!-- application code --> <script src="js/app.js"></script>
    </body>
</html>
